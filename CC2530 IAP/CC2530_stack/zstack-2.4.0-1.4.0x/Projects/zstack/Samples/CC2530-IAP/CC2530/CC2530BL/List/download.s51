///////////////////////////////////////////////////////////////////////////////
//
// IAR C/C++ Compiler V9.10.1.2146 for 8051               07/Jul/2023  16:40:18
// Copyright 2004-2014 IAR Systems AB.
// Standalone license - IAR Embedded Workbench for 8051
//
//    Core               =  plain
//    Code model         =  near
//    Data model         =  large
//    Calling convention =  xdata reentrant
//    Constant location  =  data
//    Dptr setup         =  1,16
//                          
//    Source file        =  
//        I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\Source\iap\download.c
//    Command line       =  
//        "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\Source\iap\download.c"
//        -D HAL_SB_BOOT_CODE -D HAL_UART=TRUE -D HAL_UART_DMA=0 -D
//        HAL_UART_ISR=1 -D HAL_UART_ISR_RX_MAX=254 -lC
//        "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\CC2530BL\List\"
//        -lA "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\CC2530BL\List\"
//        --diag_suppress Pe001,Pa010,Pa050 -o "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\CC2530BL\Obj\"
//        -e --debug --core=plain --dptr=16,1 --data_model=large
//        --code_model=near --calling_convention=xdata_reentrant
//        --place_constants=data --nr_virtual_regs 8 -I
//        "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\Source\drive\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\Source\iap\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\Source\shell\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\Source\sys\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\Source\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\source\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\common\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\ZMain\TI2530DB\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\..\..\Components\hal\include\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\..\..\Components\hal\target\_COMMON\CC2530\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\..\..\Components\hal\target\CC2530EB\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\..\..\Components\osal\include\"
//        -I "I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\..\..\..\..\..\Components\services\saddr\"
//        -Ohz
//    List file          =  
//        I:\1_git_code\EPnode_OTA\CC2530
//        IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\CC2530\CC2530BL\List\download.s51
//
///////////////////////////////////////////////////////////////////////////////

        NAME download

        RTMODEL "__SystemLibrary", "CLib"
        RTMODEL "__calling_convention", "xdata_reentrant"
        RTMODEL "__code_model", "near"
        RTMODEL "__core", "plain"
        RTMODEL "__data_model", "large"
        RTMODEL "__dptr_size", "16"
        RTMODEL "__extended_stack", "disabled"
        RTMODEL "__iar_require _formatted_write", "qualifiers"
        RTMODEL "__location_for_constants", "data"
        RTMODEL "__number_of_dptrs", "1"
        RTMODEL "__rt_version", "1"

        RSEG DOVERLAY:DATA:NOROOT(0)
        RSEG IOVERLAY:IDATA:NOROOT(0)
        RSEG ISTACK:IDATA:NOROOT(0)
        RSEG PSTACK:XDATA:NOROOT(0)
        RSEG XSTACK:XDATA:NOROOT(0)

        EXTERN ?V0
        EXTERN ?V1
        EXTERN ?V2
        EXTERN ?V3
        EXTERN ?V4
        EXTERN ?V5
        EXTERN ?ALLOC_XSTACK8
        EXTERN ?DEALLOC_XSTACK8
        EXTERN ?FUNC_ENTER_XDATA
        EXTERN ?FUNC_LEAVE_XDATA
        EXTERN ?L_EQ_X
        EXTERN ?MOVE_LONG8_XDATA_XDATA
        EXTERN ?PUSH_XSTACK8_X_FOUR
        EXTERN ?PUSH_XSTACK_I_FOUR
        EXTERN ?PUSH_XSTACK_I_TWO
        EXTERN ?SL_GE_X
        EXTERN ?XLOAD_R2345
        EXTERN ?XSP
        EXTERN ?XSTACK_DISP101_8
        EXTERN __INIT_XDATA_I

        PUBLIC IAP_download
        FUNCTION IAP_download,0a1203H
        ARGFRAME XSTACK, 0, STACK
        LOCFRAME XSTACK, 32, STACK
        PUBWEAK _A_P1
        PUBWEAK __Constant_1
        PUBWEAK __Constant_12c
        PUBWEAK __Constant_37800
        PUBWEAK __Constant_5000
        PUBWEAK __Constant_ffffffe2
        PUBWEAK __Constant_fffffff5
        PUBWEAK __Constant_fffffff6
        PUBWEAK __Constant_ffffffff
        
          CFI Names cfiNames0
          CFI StackFrame CFA_SP SP IDATA
          CFI StackFrame CFA_PSP16 PSP16 XDATA
          CFI StackFrame CFA_XSP16 XSP16 XDATA
          CFI StaticOverlayFrame CFA_IOVERLAY IOVERLAY
          CFI StaticOverlayFrame CFA_DOVERLAY DOVERLAY
          CFI Resource `PSW.CY`:1, `B.BR0`:1, `B.BR1`:1, `B.BR2`:1, `B.BR3`:1
          CFI Resource `B.BR4`:1, `B.BR5`:1, `B.BR6`:1, `B.BR7`:1, `VB.BR8`:1
          CFI Resource `VB.BR9`:1, `VB.BR10`:1, `VB.BR11`:1, `VB.BR12`:1
          CFI Resource `VB.BR13`:1, `VB.BR14`:1, `VB.BR15`:1, VB:8, B:8, A:8
          CFI Resource PSW:8, DPL0:8, DPH0:8, R0:8, R1:8, R2:8, R3:8, R4:8, R5:8
          CFI Resource R6:8, R7:8, V0:8, V1:8, V2:8, V3:8, V4:8, V5:8, V6:8, V7:8
          CFI Resource SP:8, PSPH:8, PSPL:8, PSP16:16, XSPH:8, XSPL:8, XSP16:16
          CFI VirtualResource ?RET:16, ?RET_HIGH:8, ?RET_LOW:8
          CFI ResourceParts PSP16 PSPH, PSPL
          CFI ResourceParts XSP16 XSPH, XSPL
          CFI ResourceParts ?RET ?RET_HIGH, ?RET_LOW
          CFI EndNames cfiNames0
        
          CFI Common cfiCommon0 Using cfiNames0
          CFI CodeAlign 1
          CFI DataAlign -1
          CFI ReturnAddress ?RET CODE
          CFI CFA_DOVERLAY Used
          CFI CFA_IOVERLAY Used
          CFI CFA_SP SP+-2
          CFI CFA_PSP16 PSP16+0
          CFI CFA_XSP16 XSP16+0
          CFI `PSW.CY` SameValue
          CFI `B.BR0` SameValue
          CFI `B.BR1` SameValue
          CFI `B.BR2` SameValue
          CFI `B.BR3` SameValue
          CFI `B.BR4` SameValue
          CFI `B.BR5` SameValue
          CFI `B.BR6` SameValue
          CFI `B.BR7` SameValue
          CFI `VB.BR8` SameValue
          CFI `VB.BR9` SameValue
          CFI `VB.BR10` SameValue
          CFI `VB.BR11` SameValue
          CFI `VB.BR12` SameValue
          CFI `VB.BR13` SameValue
          CFI `VB.BR14` SameValue
          CFI `VB.BR15` SameValue
          CFI VB SameValue
          CFI B Undefined
          CFI A Undefined
          CFI PSW SameValue
          CFI DPL0 SameValue
          CFI DPH0 SameValue
          CFI R0 Undefined
          CFI R1 Undefined
          CFI R2 Undefined
          CFI R3 Undefined
          CFI R4 Undefined
          CFI R5 Undefined
          CFI R6 SameValue
          CFI R7 SameValue
          CFI V0 SameValue
          CFI V1 SameValue
          CFI V2 SameValue
          CFI V3 SameValue
          CFI V4 SameValue
          CFI V5 SameValue
          CFI V6 SameValue
          CFI V7 SameValue
          CFI PSPH Undefined
          CFI PSPL Undefined
          CFI XSPH Undefined
          CFI XSPL Undefined
          CFI ?RET Concat
          CFI ?RET_HIGH Frame(CFA_SP, 2)
          CFI ?RET_LOW Frame(CFA_SP, 1)
          CFI EndCommon cfiCommon0
        
        EXTERN Int2Str
        FUNCTION Int2Str,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN Ymodem_Receive
        FUNCTION Ymodem_Receive,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 32, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN delay_ms
        FUNCTION delay_ms,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN file_name
        EXTERN printf
        FUNCTION printf,0202H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 32, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        EXTERN sys_parameter
        EXTERN usart0_mode
        EXTERN write_sys_parameter
        FUNCTION write_sys_parameter,0200H
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC

// I:\1_git_code\EPnode_OTA\CC2530 IAP\CC2530_stack\zstack-2.4.0-1.4.0x\Projects\zstack\Samples\CC2530-IAP\Source\iap\download.c
//    1 #include "download.h"

        ASEGN SFR_AN:DATA:NOROOT,090H
// union <unnamed> volatile __sfr _A_P1
_A_P1:
        DATA8
        DS 1
//    2 #include "iap_config.h"
//    3 #include "ymodem.h"
//    4 #include "uart.h"
//    5 #include "hal_flash.h"
//    6 
//    7 extern uint8_t file_name[FILE_NAME_LENGTH];
//    8 
//    9 // 通过串口 IAP 向 flash 下载一个文件

        RSEG NEAR_CODE:CODE:NOROOT(0)
//   10 void IAP_download(void)
IAP_download:
          CFI Block cfiBlock0 Using cfiCommon0
          CFI Function IAP_download
        CODE
//   11 {
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 32, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 32, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, Ymodem_Receive
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 32, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 32, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, delay_ms
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 26, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 26, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, Int2Str
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 28, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 28, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 26, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 26, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, write_sys_parameter
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        FUNCALL IAP_download, printf
        LOCFRAME ISTACK, 0, STACK
        LOCFRAME PSTACK, 0, STACK
        LOCFRAME XSTACK, 24, STACK
        LOCFRAME IOVERLAY, 0, STATIC
        LOCFRAME DOVERLAY, 0, STATIC
        ARGFRAME ISTACK, 0, STACK
        ARGFRAME PSTACK, 0, STACK
        ARGFRAME XSTACK, 24, STACK
        ARGFRAME IOVERLAY, 0, STATIC
        ARGFRAME DOVERLAY, 0, STATIC
        REQUIRE ?V0
        REQUIRE ?V1
        REQUIRE ?V2
        REQUIRE ?V3
        REQUIRE ?V4
        REQUIRE ?V5
        MOV     A,#-0xd
        LCALL   ?FUNC_ENTER_XDATA
          CFI DPH0 load(1, XDATA, add(CFA_XSP16, literal(-1)))
          CFI DPL0 load(1, XDATA, add(CFA_XSP16, literal(-2)))
          CFI ?RET_HIGH load(1, XDATA, add(CFA_XSP16, literal(-3)))
          CFI ?RET_LOW load(1, XDATA, add(CFA_XSP16, literal(-4)))
          CFI R7 load(1, XDATA, add(CFA_XSP16, literal(-5)))
          CFI V5 load(1, XDATA, add(CFA_XSP16, literal(-6)))
          CFI V4 load(1, XDATA, add(CFA_XSP16, literal(-7)))
          CFI V3 load(1, XDATA, add(CFA_XSP16, literal(-8)))
          CFI V2 load(1, XDATA, add(CFA_XSP16, literal(-9)))
          CFI V1 load(1, XDATA, add(CFA_XSP16, literal(-10)))
          CFI V0 load(1, XDATA, add(CFA_XSP16, literal(-11)))
          CFI VB load(1, XDATA, add(CFA_XSP16, literal(-12)))
          CFI R6 load(1, XDATA, add(CFA_XSP16, literal(-13)))
          CFI CFA_SP SP+0
          CFI CFA_XSP16 add(XSP16, 13)
        ; Saved register size: 13
        ; Auto size: 11
        MOV     A,#-0xb
        LCALL   ?ALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//   12   uint8_t Number[11] = "          ";
        MOV     DPTR,#`?<Constant "          ">`
        MOV     R4,?XSP + 0
        MOV     R5,?XSP + 1
        MOV     A,#0xb
        LCALL   ?MOVE_LONG8_XDATA_XDATA
//   13   int32_t Size = 0;
//   14   uint32_t times=300;       // 发送300次
//   15   LED1 = 1;
        SETB    0x90.1
//   16   
//   17   /* 进入下载模式 */
//   18   debug_info("download partition start_address:0x%lx,size:%ld Bytes\n\r",
//   19      APP1_PARTITION_START_ADDR,APP1_PARTITION_SIZE);
        ; Setup parameters for call to function printf
        MOV     DPTR,#__Constant_37800
        LCALL   ?PUSH_XSTACK8_X_FOUR
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     DPTR,#__Constant_5000
        LCALL   ?PUSH_XSTACK8_X_FOUR
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     R2,#`?<Constant "download partition st...">` & 0xff
        MOV     R3,#(`?<Constant "download partition st...">` >> 8) & 0xff
        LCALL   printf
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//   20   debug_info("Waiting for the file to be sent ... (press 'a' key to exit IAP mode)\n\r");
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "Waiting for the file ...">` & 0xff
        MOV     R3,#(`?<Constant "Waiting for the file ...">` >> 8) & 0xff
        LCALL   printf
//   21   
//   22   // 阻塞运行
//   23   Size = Ymodem_Receive(APP1_PARTITION_START_ADDR,APP1_PARTITION_SIZE,times);
        ; Setup parameters for call to function Ymodem_Receive
        MOV     DPTR,#__Constant_12c
        LCALL   ?PUSH_XSTACK8_X_FOUR
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     DPTR,#__Constant_37800
        LCALL   ?PUSH_XSTACK8_X_FOUR
          CFI CFA_XSP16 add(XSP16, 32)
        MOV     DPTR,#__Constant_5000
        LCALL   ?XLOAD_R2345
        LCALL   Ymodem_Receive
        MOV     A,#0x8
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
        MOV     ?V0,R2
        MOV     ?V1,R3
        MOV     ?V2,R4
        MOV     ?V3,R5
//   24   delay_ms(500);
        ; Setup parameters for call to function delay_ms
        MOV     R2,#-0xc
        MOV     R3,#0x1
        LCALL   delay_ms
//   25   if (Size > 0)
        MOV     DPTR,#__Constant_1
        MOV     R0,#?V0
        LCALL   ?SL_GE_X
        JNC     ??IAP_download_0
//   26   {
//   27     debug_info("\n\n\r Programming Successed!\n\r--------------------------------\r\n Name: %s",(char*)file_name);
        ; Setup parameters for call to function printf
        MOV     ?V4,#file_name & 0xff
        MOV     ?V5,#(file_name >> 8) & 0xff
        MOV     R0,#?V4
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     R2,#`?<Constant "\\n\\n\\r Programming Succe...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\n\\r Programming Succe...">` >> 8) & 0xff
        LCALL   printf
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//   28     Int2Str(Number, Size);
        ; Setup parameters for call to function Int2Str
        MOV     R0,#?V0
        LCALL   ?PUSH_XSTACK_I_FOUR
          CFI CFA_XSP16 add(XSP16, 28)
        MOV     A,#0x4
        LCALL   ?XSTACK_DISP101_8
        LCALL   Int2Str
        MOV     A,#0x4
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//   29     debug_info("\n\r Size: %s Bytes\r\n",(char*)Number);
        ; Setup parameters for call to function printf
        MOV     R0,?XSP + 0
        MOV     R1,?XSP + 1
        MOV     ?V0,R0
        MOV     ?V1,R1
        MOV     R0,#?V0
        LCALL   ?PUSH_XSTACK_I_TWO
          CFI CFA_XSP16 add(XSP16, 26)
        MOV     R2,#`?<Constant "\\n\\r Size: %s Bytes\\r\\n">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\r Size: %s Bytes\\r\\n">` >> 8) & 0xff
        LCALL   printf
        MOV     A,#0x2
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 24)
//   30     debug_info("-------------------\r\n");
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "-------------------\\r\\n">` & 0xff
        MOV     R3,#(`?<Constant "-------------------\\r\\n">` >> 8) & 0xff
        LCALL   printf
//   31     sys_parameter.app1_flag=APP_OK;
        MOV     DPTR,#sys_parameter + 1
        MOV     A,#0x4d
        MOVX    @DPTR,A
//   32     write_sys_parameter(); 
        ; Setup parameters for call to function write_sys_parameter
        LCALL   write_sys_parameter
        SJMP    ??IAP_download_1
//   33   }
//   34   else if (Size == 0) debug_err("\n\r"ERR"Termination by sender!\n\r");
??IAP_download_0:
        MOV     A,?V0
        ORL     A,?V1
        ORL     A,?V2
        ORL     A,?V3
        JNZ     ??IAP_download_2
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rERROR:Termination b...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rERROR:Termination b...">` >> 8) & 0xff
        SJMP    ??IAP_download_3
//   35   else if (Size == -1) debug_err("\n\r"ERR"Programming address error or File too large!\n\r");
??IAP_download_2:
        MOV     DPTR,#__Constant_ffffffff
        MOV     R0,#?V0
        LCALL   ?L_EQ_X
        JNZ     ??IAP_download_4
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rERROR:Programming a...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rERROR:Programming a...">` >> 8) & 0xff
        SJMP    ??IAP_download_3
//   36   else if (Size == -10) debug_err("\n\r"ERR"Error count exceeded.\n\r");
??IAP_download_4:
        MOV     DPTR,#__Constant_fffffff6
        MOV     R0,#?V0
        LCALL   ?L_EQ_X
        JNZ     ??IAP_download_5
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rERROR:Error count e...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rERROR:Error count e...">` >> 8) & 0xff
        SJMP    ??IAP_download_3
//   37   else if (Size == -11) debug_err("\n\r"ERR"Waiting timeout\n\r");
??IAP_download_5:
        MOV     DPTR,#__Constant_fffffff5
        MOV     R0,#?V0
        LCALL   ?L_EQ_X
        JNZ     ??IAP_download_6
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rERROR:Waiting timeo...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rERROR:Waiting timeo...">` >> 8) & 0xff
        SJMP    ??IAP_download_3
//   38   else if (Size == -30) debug_war("\n\r"WARNING"Aborted by user.\n\r");
??IAP_download_6:
        MOV     DPTR,#__Constant_ffffffe2
        MOV     R0,#?V0
        LCALL   ?L_EQ_X
        JNZ     ??IAP_download_7
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rWARNING:Aborted by ...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rWARNING:Aborted by ...">` >> 8) & 0xff
        SJMP    ??IAP_download_3
//   39   else debug_err("\n\r"ERR"Failed to receive the file!\n\r");
??IAP_download_7:
        ; Setup parameters for call to function printf
        MOV     R2,#`?<Constant "\\n\\rERROR:Failed to rec...">` & 0xff
        MOV     R3,#(`?<Constant "\\n\\rERROR:Failed to rec...">` >> 8) & 0xff
??IAP_download_3:
        LCALL   printf
//   40 
//   41   /* 进入控制台模式 */
//   42   usart0_mode=0;
??IAP_download_1:
        MOV     DPTR,#usart0_mode
        CLR     A
        MOVX    @DPTR,A
//   43 }
        MOV     A,#0xb
        LCALL   ?DEALLOC_XSTACK8
          CFI CFA_XSP16 add(XSP16, 13)
        MOV     R7,#0x6
        LJMP    ?FUNC_LEAVE_XDATA
          CFI EndBlock cfiBlock0
        REQUIRE _A_P1

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "          ">>`:
        DB "          "

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "download partitio`:
        DB 64H, 6FH, 77H, 6EH, 6CH, 6FH, 61H, 64H
        DB 20H, 70H, 61H, 72H, 74H, 69H, 74H, 69H
        DB 6FH, 6EH, 20H, 73H, 74H, 61H, 72H, 74H
        DB 5FH, 61H, 64H, 64H, 72H, 65H, 73H, 73H
        DB 3AH, 30H, 78H, 25H, 6CH, 78H, 2CH, 73H
        DB 69H, 7AH, 65H, 3AH, 25H, 6CH, 64H, 20H
        DB 42H, 79H, 74H, 65H, 73H, 0AH, 0DH, 0

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "Waiting for the f`:
        DB 57H, 61H, 69H, 74H, 69H, 6EH, 67H, 20H
        DB 66H, 6FH, 72H, 20H, 74H, 68H, 65H, 20H
        DB 66H, 69H, 6CH, 65H, 20H, 74H, 6FH, 20H
        DB 62H, 65H, 20H, 73H, 65H, 6EH, 74H, 20H
        DB 2EH, 2EH, 2EH, 20H, 28H, 70H, 72H, 65H
        DB 73H, 73H, 20H, 27H, 61H, 27H, 20H, 6BH
        DB 65H, 79H, 20H, 74H, 6FH, 20H, 65H, 78H
        DB 69H, 74H, 20H, 49H, 41H, 50H, 20H, 6DH
        DB 6FH, 64H, 65H, 29H, 0AH, 0DH, 0

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\n\\r Programmin`:
        DB 0AH, 0AH, 0DH, 20H, 50H, 72H, 6FH, 67H
        DB 72H, 61H, 6DH, 6DH, 69H, 6EH, 67H, 20H
        DB 53H, 75H, 63H, 63H, 65H, 73H, 73H, 65H
        DB 64H, 21H, 0AH, 0DH, 2DH, 2DH, 2DH, 2DH
        DB 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH
        DB 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH
        DB 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH, 2DH
        DB 2DH, 2DH, 2DH, 2DH, 0DH, 0AH, 20H, 4EH
        DB 61H, 6DH, 65H, 3AH, 20H, 25H, 73H, 0

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\r Size: %s Byt`:
        DB "\012\015 Size: %s Bytes\015\012"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "-----------------`:
        DB "-------------------\015\012"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rERROR:Termina`:
        DB "\012\015ERROR:Termination by sender!\012\015"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rERROR:Program`:
        DB 0AH, 0DH, 45H, 52H, 52H, 4FH, 52H, 3AH
        DB 50H, 72H, 6FH, 67H, 72H, 61H, 6DH, 6DH
        DB 69H, 6EH, 67H, 20H, 61H, 64H, 64H, 72H
        DB 65H, 73H, 73H, 20H, 65H, 72H, 72H, 6FH
        DB 72H, 20H, 6FH, 72H, 20H, 46H, 69H, 6CH
        DB 65H, 20H, 74H, 6FH, 6FH, 20H, 6CH, 61H
        DB 72H, 67H, 65H, 21H, 0AH, 0DH, 0

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rERROR:Error c`:
        DB "\012\015ERROR:Error count exceeded.\012\015"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rERROR:Waiting`:
        DB "\012\015ERROR:Waiting timeout\012\015"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rWARNING:Abort`:
        DB "\012\015WARNING:Aborted by user.\012\015"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for <Constant "\\n\\rERROR:Failed `:
        DB "\012\015ERROR:Failed to receive the file!\012\015"

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_37800>`:
        DATA32
        DD 227328

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_5000>`:
        DATA32
        DD 20480

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_12c>`:
        DATA32
        DD 300

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_1>`:
        DATA32
        DD 1

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_ffffffff>`:
        DATA32
        DD -1

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_fffffff6>`:
        DATA32
        DD -10

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_fffffff5>`:
        DATA32
        DD -11

        RSEG XDATA_ID:CODE:NOROOT(0)
`?<Initializer for __Constant_ffffffe2>`:
        DATA32
        DD -30

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "          ">`:
        DS 11
        REQUIRE `?<Initializer for <Constant "          ">>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "download partition st...">`:
        DS 56
        REQUIRE `?<Initializer for <Constant "download partitio`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "Waiting for the file ...">`:
        DS 71
        REQUIRE `?<Initializer for <Constant "Waiting for the f`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\n\\r Programming Succe...">`:
        DS 72
        REQUIRE `?<Initializer for <Constant "\\n\\n\\r Programmin`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\r Size: %s Bytes\\r\\n">`:
        DS 20
        REQUIRE `?<Initializer for <Constant "\\n\\r Size: %s Byt`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "-------------------\\r\\n">`:
        DS 22
        REQUIRE `?<Initializer for <Constant "-----------------`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rERROR:Termination b...">`:
        DS 33
        REQUIRE `?<Initializer for <Constant "\\n\\rERROR:Termina`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rERROR:Programming a...">`:
        DS 55
        REQUIRE `?<Initializer for <Constant "\\n\\rERROR:Program`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rERROR:Error count e...">`:
        DS 32
        REQUIRE `?<Initializer for <Constant "\\n\\rERROR:Error c`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rERROR:Waiting timeo...">`:
        DS 26
        REQUIRE `?<Initializer for <Constant "\\n\\rERROR:Waiting`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rWARNING:Aborted by ...">`:
        DS 29
        REQUIRE `?<Initializer for <Constant "\\n\\rWARNING:Abort`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA8
`?<Constant "\\n\\rERROR:Failed to rec...">`:
        DS 38
        REQUIRE `?<Initializer for <Constant "\\n\\rERROR:Failed `
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_37800:
        DS 4
        REQUIRE `?<Initializer for __Constant_37800>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_5000:
        DS 4
        REQUIRE `?<Initializer for __Constant_5000>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_12c:
        DS 4
        REQUIRE `?<Initializer for __Constant_12c>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_1:
        DS 4
        REQUIRE `?<Initializer for __Constant_1>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_ffffffff:
        DS 4
        REQUIRE `?<Initializer for __Constant_ffffffff>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_fffffff6:
        DS 4
        REQUIRE `?<Initializer for __Constant_fffffff6>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_fffffff5:
        DS 4
        REQUIRE `?<Initializer for __Constant_fffffff5>`
        REQUIRE __INIT_XDATA_I

        RSEG XDATA_I:XDATA:NOROOT(0)
        DATA32
__Constant_ffffffe2:
        DS 4
        REQUIRE `?<Initializer for __Constant_ffffffe2>`
        REQUIRE __INIT_XDATA_I

        END
//   44 
// 
// 292 bytes in segment NEAR_CODE
//   1 byte  in segment SFR_AN
// 497 bytes in segment XDATA_I
// 497 bytes in segment XDATA_ID
// 
// 757 bytes of CODE  memory (+ 32 bytes shared)
//   0 bytes of DATA  memory (+  1 byte  shared)
// 465 bytes of XDATA memory (+ 32 bytes shared)
//
//Errors: none
//Warnings: none
